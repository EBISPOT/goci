drop table gwasdiseasecategories;
drop table T_gwasstudies;
drop table gwasncbiannotated;

alter table gwasefoxref
	rename to gwasefostudyxref;
alter table gwasstudiessnp
	rename to gwasassociations;

alter table gwasstudies 
        drop (AUTHOR_ORIGINAL, AUTHORSEARCH, DISEASETRAIT, REGION, GENE, STRONGESTALLELE, RISKFREQUENCY, PVALUE, ORPERCOPY, CREATEDATE, NIHGRANTSUPPORT, EFOID, EFOTRAIT, EFOURI, NOTES, CATEGORYID, ASSOCIATIONLVLCATEGORYID, ETHNICITY_NA_INITIAL, ETHNICITY_NA_REPLICATE, LINK);


alter table gwasstudies
	rename column linktitle to title;

alter table gwasstudies
	rename column CHECKEDHEATHER to studysnpcheckedl1;

alter table gwasstudies
	rename column CHECKEDLUCIA to studysnpcheckedl2;

alter table gwasstudies
	rename column ETHNICITYCHECKEDBYHEATHER to ethnicitycheckedl2;

alter table gwasstudies
	rename column ETHNICITYCHECKEDBYJAYAPEGGY to ethnicitycheckedl1;


CREATE TABLE HOUSEKEEPING
(ID NUMBER(7) NOT NULL,  
STUDYID NUMBER(7) NOT NULL,  
STUDYSNPCHECKEDL1 NUMBER(1) DEFAULT 0  NOT NULL, 
STUDYSNPCHECKEDL2 NUMBER(1) DEFAULT 0  NOT NULL, 
PUBLISH NUMBER(1) DEFAULT 0  NOT NULL, 
PENDING NUMBER(1) DEFAULT 0  NOT NULL, 
PUBLISHDATE DATE, 
NOTES VARCHAR2(4000), 
STUDYADDEDDATE TIMESTAMP(6), 
LASTUPDATEDATE TIMESTAMP(6),  
ETHNICITYCHECKEDL1 NUMBER(1) DEFAULT 0 , 
ETHNICITYCHECKEDL2 NUMBER(1) DEFAULT 0 , 
SENDTONCBI NUMBER, 
SENDTONCBIDATE DATE, 
CHECKEDNCBIERROR NUMBER(1) DEFAULT 0  NOT NULL, 
FILENAM VARCHAR2(96), 
CURATORID NUMBER, 
CURATORSTATUSID NUMBER, 
ETHNICITYBACKFILLED NUMBER(1) DEFAULT 0 , 
RECHECKSNPS NUMBER(1) DEFAULT 0  NOT NULL, 
CONSTRAINT HOUSEKEEPINGID PRIMARY KEY (ID));

create sequence housekeepingseq;

--/
CREATE OR REPLACE TRIGGER housekeeping_bir
BEFORE INSERT ON housekeeping
FOR EACH ROW
BEGIN
  SELECT housekeepingseq.NEXTVAL
  INTO   :new.id
  FROM   dual;
END;
/


insert into housekeeping
(STUDYID,  
STUDYSNPCHECKEDL1, 
STUDYSNPCHECKEDL2, 
PUBLISH, 
PENDING, 
PUBLISHDATE, 
NOTES, 
STUDYADDEDDATE, 
LASTUPDATEDATE,  
ETHNICITYCHECKEDL1, 
ETHNICITYCHECKEDL2, 
SENDTONCBI, 
SENDTONCBIDATE, 
CHECKEDNCBIERROR, 
FILENAM, 
CURATORID, 
CURATORSTATUSID, 
ETHNICITYBACKFILLED, 
RECHECKSNPS)
select id as studyid, STUDYSNPCHECKEDL1, STUDYSNPCHECKEDL2, PUBLISH, PENDING, PUBLISHDATE, NOTESTEXT, STUDYADDEDDATE, LASTUPDATEDATE,  ETHNICITYCHECKEDL1, ETHNICITYCHECKEDL2, SENDTONCBI, SENDTONCBIDATE, 
CHECKEDNCBIERROR, FILENAM, CURATORID, CURATORSTATUSID, ETHNICITYBACKFILLED, RECHECKSNPS
from gwasstudies;


create table ncbireport
(ID NUMBER(7) NOT NULL, 
STUDYID NUMBER(7) NOT NULL,   
NCBIPAPER_TITLE VARCHAR2(512), 
PUBMDID_ERROR NUMBER, 
NCBIAUTHOR_FIRST VARCHAR2(96), 
NCBIAUTHOR_FIRST_NORMALIZED VARCHAR2(96), 
NCBIFIRSTUPDATEDATE DATE, 
CONSTRAINT NCBIREPORTID PRIMARY KEY (ID));

create sequence ncbireportseq;

--/
CREATE OR REPLACE TRIGGER ncbireport_bir
BEFORE INSERT ON ncbireport
FOR EACH ROW
BEGIN
  SELECT ncbireportseq.NEXTVAL
  INTO   :new.id
  FROM   dual;
END;
/


insert into ncbireport(
studyid,
NCBIPAPER_TITLE,
PUBMDID_ERROR,
NCBIAUTHOR_FIRST,
NCBIAUTHOR_FIRST_NORMALIZED,
NCBIFIRSTUPDATEDATE)
select id as studyid, NCBIPAPER_TITLE,
PUBMDID_ERROR,
NCBIAUTHOR_FIRST,
NCBIAUTHOR_FIRST_NORMALIZED,
NCBIFIRSTUPDATEDATE
from gwasstudies;

alter table gwasstudies
drop (STUDYSNPCHECKEDL1, STUDYSNPCHECKEDL2, PUBLISH, PENDING, PUBLISHDATE, NOTESTEXT, STUDYADDEDDATE, LASTUPDATEDATE,  ETHNICITYCHECKEDL1, ETHNICITYCHECKEDL2, SENDTONCBI, SENDTONCBIDATE, 
CHECKEDNCBIERROR, FILENAM, CURATORID, CURATORSTATUSID, ETHNICITYBACKFILLED, RECHECKSNPS, NCBIPAPER_TITLE, PUBMDID_ERROR, NCBIAUTHOR_FIRST, NCBIAUTHOR_FIRST_NORMALIZED, NCBIFIRSTUPDATEDATE);


alter table gwasassociations
drop (region, pvalue, orpercopy, pvaluenum, orpercopytxt, notes, associationlvlcategoryid, snp_id_current, pvalue_mlog);

alter table gwasassociations
rename column gwasid to studyid;


create table associationreport
(ID NUMBER(7) NOT NULL, 
ASSOCIATIONID NUMBER(7) NOT NULL,
SNPPENDING NUMBER(1) DEFAULT 0, 
LASTUPDATEDATE TIMESTAMP(6), 
GENE_ERROR INTEGER, 
SNP_GENE_ON_DIFF_CHR VARCHAR2(256), 
PUBMDID_ERROR INTEGER, 
NO_GENEID_FOR_SYMBOL VARCHAR2(256), 
SNP_ID_ERROR VARCHAR2(512), 
GENE_NOT_ON_GENOME VARCHAR2(264), 
CONSTRAINT ASSOCIATIONREPORTID PRIMARY KEY (ID));

create sequence associationreportseq;

--/
CREATE OR REPLACE TRIGGER associationreport_bir
BEFORE INSERT ON associationreport
FOR EACH ROW
BEGIN
  SELECT associationreportseq.NEXTVAL
  INTO   :new.id
  FROM   dual;
END;
/


insert into associationreport(ASSOCIATIONID,
SNPPENDING,
LASTUPDATEDATE,
GENE_ERROR,
SNP_GENE_ON_DIFF_CHR,
PUBMDID_ERROR,
NO_GENEID_FOR_SYMBOL,
SNP_ID_ERROR,
GENE_NOT_ON_GENOME)
select id as ASSOCIATIONID,
SNPPENDING,
LASTUPDATEDATE,
GENE_ERROR,
SNP_GENE_ON_DIFF_CHR,
PUBMDID_ERROR,
NO_GENEID_FOR_SYMBOL,
SNP_ID_ERROR,
GENE_NOT_ON_GENOME
from gwasassociations;

alter table gwasassociations
drop 
(SNPPENDING,
LASTUPDATEDATE,
GENE_ERROR,
SNP_GENE_ON_DIFF_CHR,
PUBMDID_ERROR,
NO_GENEID_FOR_SYMBOL,
SNP_ID_ERROR,
GENE_NOT_ON_GENOME)


create table snptemp
(ID NUMBER(7) NOT NULL, 
ASSOCIATIONID NUMBER(7) NOT NULL,
CHR_ID VARCHAR2(8), 
CHR_POS INTEGER, 
MERGED INTEGER, 
CYTOGENETIC_LOC VARCHAR2(64), 
FUNCTIONAL_CLASS VARCHAR2(128), 
SNP_GENE_SYMBOLS VARCHAR2(255), 
UPSTREAM_GENE_SYMBOL VARCHAR2(32), 
DOWNSTREAM_GENE_SYMBOL VARCHAR2(32), 
UPSTREAM_GENE_DISTANCE INTEGER, 
DOWNSTREAM_GENE_DISTANCE INTEGER, 
UPSTREAM_GENE_ID INTEGER, 
DOWNSTREAM_GENE_ID INTEGER, 
INTERGENIC NUMBER, 
SNP_GENE_IDS VARCHAR2(100), 
CONSTRAINT SNPTEMPID PRIMARY KEY (ID));


create sequence snptempseq;

--/
CREATE OR REPLACE TRIGGER snptemp_bir
BEFORE INSERT ON snptemp
FOR EACH ROW
BEGIN
  SELECT snptempseq.NEXTVAL
  INTO   :new.id
  FROM   dual;
END;
/

insert into snptemp(ASSOCIATIONID,
CHR_ID,
CHR_POS,
MERGED,
CYTOGENETIC_LOC,
FUNCTIONAL_CLASS,
SNP_GENE_SYMBOLS,
UPSTREAM_GENE_SYMBOL,
DOWNSTREAM_GENE_SYMBOL,
UPSTREAM_GENE_DISTANCE,
DOWNSTREAM_GENE_DISTANCE,
UPSTREAM_GENE_ID,
DOWNSTREAM_GENE_ID,
INTERGENIC,
SNP_GENE_IDS)
select id as ASSOCIATIONID,
CHR_ID,
CHR_POS,
MERGED,
CYTOGENETIC_LOC,
FUNCTIONAL_CLASS,
SNP_GENE_SYMBOLS,
UPSTREAM_GENE_SYMBOL,
DOWNSTREAM_GENE_SYMBOL,
UPSTREAM_GENE_DISTANCE,
DOWNSTREAM_GENE_DISTANCE,
UPSTREAM_GENE_ID,
DOWNSTREAM_GENE_ID,
INTERGENIC,
SNP_GENE_IDS
from gwasassociations;


alter table gwasassociations 
drop(CHR_ID,
CHR_POS,
MERGED,
CYTOGENETIC_LOC,
FUNCTIONAL_CLASS,
SNP_GENE_SYMBOLS,
UPSTREAM_GENE_SYMBOL,
DOWNSTREAM_GENE_SYMBOL,
UPSTREAM_GENE_DISTANCE,
DOWNSTREAM_GENE_DISTANCE,
UPSTREAM_GENE_ID,
DOWNSTREAM_GENE_ID,
INTERGENIC,
SNP_GENE_IDS);


alter table gwasethnicity
rename column gwasid to studyid;

alter table gwasethnicity
drop (CHECKEDBYJAYAPEGGY, CHECKEDBYHEATHER, READYTOPUBLISH, COUNTRYORIGINID, COUNTRYRECRUITMENTID);

alter table gwasefosnpxref
rename column gwasstudiessnpid to associationid;

alter table gwasgenexref
rename column gwasstudiessnpid to associationid;

alter table gwasregionxref
rename column gwasstudiessnpid to associationid;

alter table gwassnpxref
rename column gwasstudiessnpid to associationid;

alter table gwassnp
rename to gwassnp_old;

create table gwassnp as
select distinct s.*, t.CHR_ID,
t.CHR_POS,
t.MERGED,
t.CYTOGENETIC_LOC,
t.FUNCTIONAL_CLASS,
t.SNP_GENE_SYMBOLS,
t.UPSTREAM_GENE_SYMBOL,
t.DOWNSTREAM_GENE_SYMBOL,
t.UPSTREAM_GENE_DISTANCE,
t.DOWNSTREAM_GENE_DISTANCE,
t.UPSTREAM_GENE_ID,
t.DOWNSTREAM_GENE_ID,
t.INTERGENIC,
t.SNP_GENE_IDS
from gwassnp_old s, snptemp t, gwassnpxref sx
where s.id = sx.snpid
and t.associationid = sx.associationid;

