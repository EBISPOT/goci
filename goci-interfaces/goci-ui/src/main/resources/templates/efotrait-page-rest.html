<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="description"
          content="The NHGRI-EBI GWAS Catalog: a curated collection of all published genome-wide association studies, produced by a collaboration between EMBL-EBI and NHGRI"/>
    <meta name="keywords" content="GWAS Catalog, GWAS, NHGRI, EBI, EMBL-EBI, SPOT"/>
    <meta name="author" content="Tony Burdett, Emma Hastings, Dani Welter, SPOT, EMBL-EBI, NHGRI"/>
    <link rel="icon" href="../static/images/favicon.ico" th:href="@{images/favicon.ico}"/>

    <title>GWAS Catalog</title>

    <!-- Bootstrap core CSS -->
    <link href="../static/css/bootstrap.css" th:href="@{../../css/bootstrap.min.css}" rel="stylesheet"/>
    <link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css"
          rel="stylesheet"/>
    <link href="../static/css/bootstrap-table.css" th:href="@{../../css/bootstrap-table.css}" rel="stylesheet"/>
    <link href="../static/css/bootstrap-theme.css" th:href="@{../../css/bootstrap-theme.min.css}" rel="stylesheet"/>

    <!-- Custom styles for this template -->
    <link href="../static/css/jumbotron.css" th:href="@{../../css/jumbotron.css}" rel="stylesheet"/>
    <link href="../static/css/sticky-footer-navbar.css"
          th:href="@{../../css/sticky-footer-navbar.css}"
          rel="stylesheet"/>

    <!-- Additional styling on top of bootstrap -->
    <link rel="stylesheet" href="../static/css/goci-ui.css" th:href="@{../../css/goci-ui.css}"/>
    <link rel="stylesheet" href="../static/css/icons/flaticon.css" th:href="@{../../css/icons/flaticon.css}"/>
    <link rel="stylesheet"
          href="../static/css/goci-color-palette-1.css"
          th:href="@{../../css/goci-color-palette-1.css}"/>


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<!--Include header-->
<div th:include="fragments/header :: navbar"></div>

<!-- Main jumbotron for a primary marketing message or call to action -->
<div class="jumbotron background-color-primary-accent" style="margin: 0%; padding-bottom: 30px;">
    <div class="container clearfix">
        <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
            <h2 style="margin:0px">
                <img alt="externalLink"
                     style="width: 1em; height: auto;"
                     src="../static/icons/dna13.png"
                     th:src="@{/icons/dna13.png}"/><span style="padding-left:10px">Trait</span><span th:text="${rsId}"
                                                                                                     style="padding-left:15px"></span>
            </h2>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 col-lg-offset-1 col-md-offset-1 col-sm-offset-1 col-xs-offset-1">
            <!-- search box goes here -->
            <div class="input-group" style="width: 250px; float: right;">
                <input type="text" class="form-control" placeholder="Search the catalog" id="search-box"/>
                <span class="input-group-btn">
                        <button class="btn btn-default" type="button" id="search-button">
                            <span class="glyphicon glyphicon-search"></span>
                        </button>
                    </span>
            </div>
        </div>
    </div>
</div>


<div class="container-fluid" style="padding-top: 30px">

    <!--search meta data-->
    <ol class="breadcrumb background-color-complementary-accent">
        <li><a href="index.html" th:href="@{/home}">GWAS</a></li>
        <li><a href="#">Traits</a></li>
        <li class="active" th:text="${result.query}"></li>
    </ol>


    <div style="display: none">
        <ul th:object="${result}" id="variables">
            <li id="query" th:text="*{query}">User query</li>
            <li id="facet" th:text="*{facet}">Facet</li>
            <li id="filter" th:text="*{filter}">Disease trait</li>
        </ul>
    </div>


    <!--search result stored here to allow add/remove other efo terms, not using!-->
    <!--<div style="display: none">-->
    <!--<ul id="searchdata">-->
    <!--</ul>-->
    <!--</div>-->


    <button id="addEfoButton0" class="addEfoButton" th:value="${result.query}">reset</button>
    <button id="addEfoButton1" class="addEfoButton" value="EFO_0004211">EFO_0004211 Hypertriglyceridemia</button>
    <button id="addEfoButton2" class="addEfoButton" value="EFO_0001060">celiac disease EFO_0001060</button>
    <button id="addEfoButton3" class="addEfoButton" value="EFO_0000400 OR EFO_0004211 OR EFO_0001060">EFO_0000400 OR EFO_0004211 OR EFO_0001060</button>
    <div class="container-fluid" id="lower_container">
        <!-- Summary panel -->
        <div class="row" style="margin-top:10px">
            <div id="summary-info" class="panel panel-default" style="padding-left:0px">
                <div class="panel-heading background-color-primary-accent">
                    <h3 class="panel-title">Trait information</h3>
                </div>
                <div class="clearfix">
                    <div class="panel-body col-lg-5 col-md-5 col-sm-5 col-xs-5">
                        <div class="clearfix">
                            <div class="col-lg-4 col-md-5 col-sm-5 col-xs-5"
                                 style="font-weight: bold; margin-bottom: 1em;padding-left:0px">Trait EFO id
                            </div>
                            <div class="col-lg-8 col-md-7 col-sm-7 col-xs-7" id="efotrait-id">-</div>
                        </div>
                        <div class="clearfix">
                            <div class="col-lg-4 col-md-5 col-sm-5 col-xs-5"
                                 style="font-weight: bold; margin-bottom: 1em;padding-left:0px">Label
                            </div>
                            <div class="col-lg-8 col-md-7 col-sm-7 col-xs-7" id="efotrait-label">-</div>
                        </div>
                        <div class="clearfix">
                            <div class="col-lg-4 col-md-5 col-sm-5 col-xs-5"
                                 style="font-weight: bold; margin-bottom: 1em;padding-left:0px">Synonym(s)
                            </div>
                            <div class="col-lg-8 col-md-7 col-sm-7 col-xs-7" id="efotrait-synonym">-</div>
                        </div>
                    </div>

                </div>
                <div id="efotrait-summary">
                    <span class="glyphicon glyphicon-info-sign" style="padding-right:2px"></span>
                    <span id="efotrait-summary-content"></span>
                </div>
            </div>
        </div>

        <!-- List the available tables -->
        <div class="row" style="margin-top:0px">
            <div id="table-list" class="panel clearfix" style="padding-left:0px;box-shadow:none">
                <span style="margin-right:10px;font-weight:bold">Available data:</span>
                <button type="button"
                        class="btn btn-default"
                        style="margin-right:10px;font-weight:bold"
                        onclick="toggle_and_scroll('#association_panel')">
                    <span class="association_label">Associations</span><span class="association_count badge"
                                                                             style="background-color: #398A96;margin-left:10px"></span>
                </button>
                <button type="button"
                        class="btn btn-default"
                        style="margin-right:10px;font-weight:bold"
                        onclick="toggle_and_scroll('#study_panel')">
                    <span class="study_label">Studies</span><span class="study_count badge"
                                                                  style="background-color: #398A96;margin-left:10px"></span>
                </button>
                <!--<button type="button" class="btn btn-default" style="margin-right:10px;font-weight:bold" onclick="toggle_and_scroll('#diseasetrait_panel')">-->
                <!--<span class="diseasetrait_label">Traits</span><span class="diseasetrait_count badge" style="background-color: #398A96;margin-left:10px"></span>-->
                <!--</button>-->
            </div>
        </div>


        <!-- Associations table -->
        <div class="row" style="margin-top:20px">
            <div id="association_panel" class="panel panel-default">
                <div class="panel-heading background-color-primary-accent">
                    <h3 class="panel-title">
                        <span class="association_label">Associations</span><span class="association_count badge"
                                                                                 style="background-color: #398A96;margin-left:10px"></span>
                    </h3>
                    <span class="pull-right">
                        <button type="button" class="btn btn-default btn-xs" id="download_data">
                            <span class="glyphicon glyphicon-download-alt" style="padding-right:2px"></span>
                            <span>Download association data</span>
                        </button>
                        <span class="clickable panel-collapsed"
                              style="margin-left:25px"
                              onclick="toggleSidebar('#association_panel span.clickable')">
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </span>
                    </span>
                </div>

                <div class="panel-body" style="display:none">

                    <table id="association-table" class="table table-striped">
                        <thead id="association-table-header">
                        <tr>
                            <th style="width: 10%" id="strongestAllele">Risk allele
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Variant most strongly associated with trait + risk/effect allele. This may also be haplotype or variant x variant interaction."></span>
                                                                        <!--<span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>-->
                            </th>
                            <th style="width: 8%" id="riskFrequency">RAF
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Risk/effect allele frequency in controls"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 12%" id="pValue">p-value
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="p-value for most strongly associated variant, along with any information describing context of p-value"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 6%" id="orPerCopyNum">OR
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Odds ratio associated with variant"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 14%" id="orType">Beta
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Beta-coefficient and unit increase/decrease associated with variant"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 6%">CI
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="95% confidence interval for OR or beta"></span>
                            </th>

                            <th style="width: 8%">Reported gene(s)
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Gene(s) reported by author"></span>
                            </th>

                            <th style="width: 13%" id="traitName_s-alt">Reported trait
                                <span class="glyphicon glyphicon-question-sign"
                                      data-toggle="tooltip"
                                      data-original-title="Description of disease/trait analysed in the study"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 13%" id="traitName-alt">Mapped trait
                                <span class="glyphicon glyphicon-question-sign"
                                      data-toggle="tooltip"
                                      data-original-title="Description of disease/trait mapped to the study"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 15%" id="author_s-alt" colspan="2">Study
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="First author and year of publication, along with link to publication in Europe PubMed Central."></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                        </tr>
                        </thead>
                        <tbody id="association-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Studies table -->
        <div class="row" style="margin-top:20px">
            <div id="study_panel" class="panel panel-default">
                <div class="panel-heading background-color-primary-accent">
                    <h3 class="panel-title">
                        <span class="study_label">Studies</span><span class="study_count badge"
                                                                      style="background-color: #398A96;margin-left:10px"></span>
                    </h3>

                    <span class="pull-right clickable panel-collapsed"
                          onclick="toggleSidebar('#study_panel span.clickable')">
                        <span class="glyphicon glyphicon-chevron-down"></span>
                    </span>
                </div>

                <div class="panel-body" style="display:none">
                    <table id="study-table" class="table table-striped">
                        <thead id="study-table-header">
                        <tr>
                            <th style="width: 12%" id="author_s">Author
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="First author, along with link to publication in Europe PubMed Central."></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 10%" id="publicationDate">Date
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Publication date (YYYY-MM-DD)"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 12%" id="publication">Journal
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Abbreviated journal name"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 30%" id="title">Title
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Title of paper"></span>
                                                              <!--<span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>-->
                            </th>
                            <th style="width: 12%" id="sample_i">Initial sample description
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Description of the initial sample analysed in the study"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 12%" id="sample_r">Replication sample description
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Description of the replication sample analysed in the study"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 12%" id="ancestral_gp">Ancestral groups
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="List of the ancestral groups analysed in the study"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                        </tr>
                        </thead>
                        <tbody id="study-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>


        <!--Include footer-->
        <div th:include="fragments/footer :: page_footer"></div>

    </div>
</div>


<!-- Bootstrap core JavaScript
    ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
<script src="../static/js/bootstrap.min.js" th:src="@{../../js/bootstrap.min.js}"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="../static/js/ie10-viewport-bug-workaround.js"
        th:src="@{../../js/ie10-viewport-bug-workaround.js}"></script>

<script>
    $(document).ready(function() {
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>

<!-- GOCI JavaScript
================================================== -->
<script src="../static/js/goci-ui.js" th:src="@{../../js/goci-ui.js}"></script>
<script src="../static/js/efotraitresult.js" th:src="@{../../js/efotraitresult.js}"></script>

<!-- Necessary includes for LocusZoom.js -->
<!--<script src="https://d3js.org/d3.v4.min.js"></script>-->
<script src="../static/js/plugins/locuszoom.vendor.min.js"
        th:src="@{../../js/plugins/locuszoom.vendor.min.js}"></script>
<script src="../static/js/plugins/locuszoom.app.js" th:src="@{../../js/plugins/locuszoom.app.js}"></script>
<link rel="stylesheet" href="../static/css/locuszoom.css" th:href="@{../../css/locuszoom.css}"/>

<!--script for OLS-->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>
<!--<script src="../static/js/plugins/ols-treeview.js" th:src="@{../../js/plugins/ols-treeview.js}"></script>-->
<script src="../static/js/plugins/ols-treeview.min.js" th:src="@{../../js/plugins/ols-treeview.min.js}"></script>
<link rel="stylesheet"
      href="../static/css/proton/style.min.css"
      th:href="@{../../css/proton/style.min.css}"
      media="screen"/>


<script>
    var GWAS_REST = "https://wwwdev.ebi.ac.uk/gwas/beta/rest/api/";
    var GAS_REST_EFO_SEARCH_ENDPOINT = GWAS_REST + "efoTraits/search/findByUri?uri=http://www.ebi.ac.uk/efo/"

    $(document).ready(function() {
        var efotraitId = $('#query').text();
        console.log("Solr research request received for " + efotraitId);
        console.log(GAS_REST_EFO_SEARCH_ENDPOINT+efotraitId);
        $.getJSON(GAS_REST_EFO_SEARCH_ENDPOINT+efotraitId).done(function(data){
            console.log(data);
        })
//        setState(SearchState.LOADING);
//        $.getJSON('/gwas/api/search/efotrait',
//                  {
//                      'q': efotraitId,
//                      'max': 1000
//                  })
//                .done(function(data) {
//                    console.log(data);
//                    //xintodo consider if you want to do it this way, or just change the seach and update the tables
//                    //saveData(data.responseHeader.params.q, data);
//                    //we only process data here if it is the init load of the page, since we need to add new data to the page dynamically
//                    processEfotraitData(data, efotraitId, initLoad);
//                });
//        //serilize the data in html tag and save it in a tag for visulization
//        console.log("Solr research done for " + efotraitId);
    });

    function ajaxQueue(id,step) {
        switch(step) {
            case 0: $.ajax({
                               type: "GET",
                               url: GAS_REST_EFO_SEARCH_ENDPOINT + id,
                               complete: function() { ajaxQueue(1); }
                           }); break;
            case 1: $.ajax({
                               type: "GET",
                               url: "/some/service",
                               complete: function() { ajaxQueue(2); }
                           }); break;
            case 2: $.ajax({
                               type: "GET",
                               url: "/some/service",
                               complete: function() { alert('Done!'); }
                           }); break;
        }
    }

</script>
</body>
</html>
//    <!--//EFO:0000400-->
//    <!--//    http://localhost:8280/gwas/beta/efotrait/EFO_0000400-->
<!--https://wwwdev.ebi.ac.uk/gwas/beta/rest/docs/index-->
<!--https://wwwdev.ebi.ac.uk/gwas/beta/rest/api/efoTraits/search-->
<!--https://wwwdev.ebi.ac.uk/gwas/beta/rest/api/efoTraits-->
<!--https://wwwdev.ebi.ac.uk/gwas/beta/rest/api-->
<!--https://wwwdev.ebi.ac.uk/gwas/beta/rest/api/efoTraits/71-->
<!--https://wwwdev.ebi.ac.uk/gwas/beta/rest/api/efoTraits/search/findByUri?uri=http://www.ebi.ac.uk/efo/EFO_0000400-->
<!--https://github.com/jmarquis/angular-hateoas-->