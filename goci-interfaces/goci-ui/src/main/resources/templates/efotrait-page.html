<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="description"
          content="The NHGRI-EBI GWAS Catalog: a curated collection of all published genome-wide association studies, produced by a collaboration between EMBL-EBI and NHGRI"/>
    <meta name="keywords" content="GWAS Catalog, GWAS, NHGRI, EBI, EMBL-EBI, SPOT"/>
    <meta name="author" content="Tony Burdett, Emma Hastings, Dani Welter, SPOT, EMBL-EBI, NHGRI"/>
    <link rel="icon" href="../static/images/favicon.ico" th:href="@{images/favicon.ico}"/>

    <title>GWAS Catalog</title>
    <!-- Bootstrap core CSS -->
    <link href="../static/css/bootstrap.css" th:href="@{../../css/bootstrap.min.css}" rel="stylesheet"/>
    <!--xintodo disable for offline debug-->
    <!--<link href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css"-->
    <!--rel="stylesheet"/>-->
    <link href="../static/css/bootstrap-table.css" th:href="@{../../css/bootstrap-table.css}" rel="stylesheet"/>
    <link href="../static/css/bootstrap-theme.css" th:href="@{../../css/bootstrap-theme.min.css}" rel="stylesheet"/>

    <!-- Custom styles for this template -->
    <link href="../static/css/jumbotron.css" th:href="@{../../css/jumbotron.css}" rel="stylesheet"/>
    <link href="../static/css/sticky-footer-navbar.css"
          th:href="@{../../css/sticky-footer-navbar.css}"
          rel="stylesheet"/>

    <!-- Additional styling on top of bootstrap -->
    <link rel="stylesheet" href="../static/css/goci-ui.css" th:href="@{../../css/goci-ui.css}"/>
    <link rel="stylesheet" href="../static/css/icons/flaticon.css" th:href="@{../../css/icons/flaticon.css}"/>
    <link rel="stylesheet"
          href="../static/css/goci-color-palette-1.css"
          th:href="@{../../css/goci-color-palette-1.css}"/>


    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<!--Include header-->
<div th:include="fragments/header :: navbar"></div>

<!-- Main jumbotron for a primary marketing message or call to action -->
<div class="jumbotron background-color-primary-accent" style="margin: 0%; padding-bottom: 30px;">
    <div class="container clearfix">
        <div class="col-lg-7 col-md-7 col-sm-7 col-xs-7">
            <h2 style="margin:0px">
                <img alt="externalLink"
                     style="width: 1em; height: auto;"
                     src="../static/icons/dna13.png"
                     th:src="@{/icons/dna13.png}"/><span style="padding-left:10px">Trait</span><span th:text="${rsId}"
                                                                                                     style="padding-left:15px"></span>
            </h2>
        </div>
        <div class="col-lg-4 col-md-4 col-sm-4 col-xs-4 col-lg-offset-1 col-md-offset-1 col-sm-offset-1 col-xs-offset-1">
            <!-- search box goes here -->
            <div class="input-group" style="width: 250px; float: right;">
                <input type="text" class="form-control" placeholder="Search the catalog" id="search-box"/>
                <span class="input-group-btn">
                        <button class="btn btn-default" type="button" id="search-button">
                            <span class="glyphicon glyphicon-search"></span>
                        </button>
                    </span>
            </div>
        </div>
    </div>
</div>

<!--init search parameter-->
<div style="display: none">
    <ul th:object="${result}" id="variables">
        <li id="query" th:text="*{query}">User query</li>
        <li id="facet" th:text="*{facet}">Facet</li>
        <li id="filter" th:text="*{filter}">Disease trait</li>
    </ul>
</div>

<div class="container-fluid" style="padding-top: 30px">


    <!--search meta data-->
    <ol class="breadcrumb background-color-complementary-accent">
        <li><a href="index.html" th:href="@{/home}">GWAS</a></li>
        <li><a href="#">Traits</a></li>
        <li class="active" th:text="${result.query}"></li>
    </ol>


    <div class="container-fluid" id="lower_container">
        <!-- Summary panel -->
        <div class="row" style="margin-top:10px">
            <div id="summary-info" class="panel panel-default" style="padding-left:0px">
                <div class="panel-heading background-color-primary-accent">
                    <h3 class="panel-title">Trait information</h3>
                </div>
                <div class="clearfix">
                    <div class="panel-body col-lg-5 col-md-5 col-sm-5 col-xs-5">
                        <div class="clearfix">
                            <div class="col-lg-4 col-md-5 col-sm-5 col-xs-5"
                                 style="font-weight: bold; margin-bottom: 1em;padding-left:0px">Trait EFO id
                            </div>
                            <div class="col-lg-8 col-md-7 col-sm-7 col-xs-7" id="efotrait-id">-</div>
                        </div>
                        <div class="clearfix">
                            <div class="col-lg-4 col-md-5 col-sm-5 col-xs-5"
                                 style="font-weight: bold; margin-bottom: 1em;padding-left:0px">Label
                            </div>
                            <div class="col-lg-8 col-md-7 col-sm-7 col-xs-7" id="efotrait-label">-</div>
                        </div>
                        <div class="clearfix">
                            <div class="col-lg-4 col-md-5 col-sm-5 col-xs-5"
                                 style="font-weight: bold; margin-bottom: 1em;padding-left:0px">Synonym(s)
                            </div>
                            <div class="col-lg-8 col-md-7 col-sm-7 col-xs-7" id="efotrait-synonym">-</div>
                        </div>
                    </div>

                </div>
                <div id="efotrait-summary">
                    <span class="glyphicon glyphicon-info-sign" style="padding-right:2px"></span>
                    <span id="efotrait-summary-content"></span>
                </div>
            </div>
        </div>

        <!--Expendsion panel-->
        <div class="row" style="margin-top:20px">
            <div id= "expension_panel" class="panel panel-default">
                <div class="panel-heading background-color-primary-accent">
                    <h3 class="panel-title">
                        <span class="locus_label">Expend your search</span>
                    </h3>
                    <span class="pull-right">
                        <span class="clickable panel-collapsed"
                              style="margin-left:25px"
                              onclick="toggleSidebar('#expension_panel span.clickable')">
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </span>
                    </span>
                </div>

                <div class="panel-body" style="display:initial">
                    <div class="col-xs-12 jumbotron background-color-primary-accent">Current terms:
                        <div id="selected_efos"></div>
                        <div id="selected_efos_text"></div>
                    </div>
                    <div class="col-xs-4">
                        <!--ols tree-->
                        <div id="term-tree" style="height:300px; width:500px; border:1px solid black;overflow: auto;"></div>
                    </div>
                    <div class="col-xs-4">
                        <div id="expension">
                            <h2>Additional related terms eg. measurements and biomarkers:</h2>
                        </div>
                    </div>
                    <div class="col-xs-4">
                        <!--auto suggest-->
                        <div class="left">
                            <label>
                                <input style="font-weight: normal"
                                       size="35"
                                       type="text"
                                       name="q"
                                       data-olswidget="select"
                                       data-olsontology="efo"
                                       data-selectpath="http://www.ebi.ac.uk/ols/"
                                       olstype=""
                                       id="local-searchbox"
                                       placeholder="Enter the term you are looking for"
                                       class="ac_input">
                                </input>
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- List the available tables -->
        <div class="row" style="margin-top:0px">
            <div id="table-list" class="panel clearfix" style="padding-left:0px;box-shadow:none">
                <span style="margin-right:10px;font-weight:bold">Available data:</span>
                <button type="button"
                        class="btn btn-default"
                        style="margin-right:10px;font-weight:bold"
                        onclick="toggle_and_scroll('#locus_panel')">
                    <span class="locus_label">Manhattan plot</span><span class="glyphicon glyphicon-stats" style="color:#398A96;margin-left:10px"></span>
                </button>
                <button type="button"
                        class="btn btn-default"
                        style="margin-right:10px;font-weight:bold"
                        onclick="toggle_and_scroll('#association_panel')">
                    <span class="association_label">Associations</span><span class="association_count badge"
                                                                             style="background-color: #398A96;margin-left:10px"></span>
                </button>
                <button type="button"
                        class="btn btn-default"
                        style="margin-right:10px;font-weight:bold"
                        onclick="toggle_and_scroll('#study_panel')">
                    <span class="study_label">Studies</span><span class="study_count badge"
                                                                  style="background-color: #398A96;margin-left:10px"></span>
                </button>
                <!--<button type="button" class="btn btn-default" style="margin-right:10px;font-weight:bold" onclick="toggle_and_scroll('#diseasetrait_panel')">-->
                <!--<span class="diseasetrait_label">Traits</span><span class="diseasetrait_count badge" style="background-color: #398A96;margin-left:10px"></span>-->
                <!--</button>-->
            </div>
        </div>

        <!-- locus plot -->
        <div class="row" style="margin-top:20px">
            <div id= "locus_panel" class="panel panel-default">
                <div class="panel-heading background-color-primary-accent">
                    <h3 class="panel-title">
                        <span class="locus_label">Manhattan plot (plot of has catalog association for selected trait)</span>
                        <span class="glyphicon glyphicon-stats" style="color:#398A96;margin-left:10px"></span>
                    </h3>
                    <span class="pull-right">
                        <span class="clickable panel-collapsed"
                              style="margin-left:25px"
                              onclick="toggleSidebar('#locus_panel span.clickable')">
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </span>
                    </span>
                </div>

                <div class="panel-body" style="display:none">
                    <!-- locus plot -->
                    <div id="plot"></div>
                </div>
            </div>

        </div>

        <!-- Associations table -->
        <div class="row" style="margin-top:20px">
            <div id="association_panel" class="panel panel-default">
                <div class="panel-heading background-color-primary-accent">
                    <h3 class="panel-title">
                        <span class="association_label">Associations</span><span class="association_count badge"
                                                                                 style="background-color: #398A96;margin-left:10px"></span>
                    </h3>
                    <span class="pull-right">
                        <button type="button" class="btn btn-default btn-xs" id="download_data">
                            <span class="glyphicon glyphicon-download-alt" style="padding-right:2px"></span>
                            <span>Download association data</span>
                        </button>
                        <span class="clickable panel-collapsed"
                              style="margin-left:25px"
                              onclick="toggleSidebar('#association_panel span.clickable')">
                            <span class="glyphicon glyphicon-chevron-down"></span>
                        </span>
                    </span>
                </div>

                <div class="panel-body" style="display:none">

                    <table id="association-table" class="table table-striped">
                        <thead id="association-table-header">
                        <tr>
                            <th style="width: 10%" id="strongestAllele">Risk allele
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Variant most strongly associated with trait + risk/effect allele. This may also be haplotype or variant x variant interaction."></span>
                                                                        <!--<span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>-->
                            </th>
                            <th style="width: 8%" id="riskFrequency">RAF
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Risk/effect allele frequency in controls"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 12%" id="pValue">p-value
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="p-value for most strongly associated variant, along with any information describing context of p-value"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 6%" id="orPerCopyNum">OR
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Odds ratio associated with variant"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 14%" id="orType">Beta
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Beta-coefficient and unit increase/decrease associated with variant"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 6%">CI
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="95% confidence interval for OR or beta"></span>
                            </th>

                            <th style="width: 8%">Reported gene(s)
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Gene(s) reported by author"></span>
                            </th>

                            <th style="width: 13%" id="traitName_s-alt">Reported trait
                                <span class="glyphicon glyphicon-question-sign"
                                      data-toggle="tooltip"
                                      data-original-title="Description of disease/trait analysed in the study"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 13%" id="traitName-alt">Mapped trait
                                <span class="glyphicon glyphicon-question-sign"
                                      data-toggle="tooltip"
                                      data-original-title="Description of disease/trait mapped to the study"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 15%" id="author_s-alt" colspan="2">Study
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="First author and year of publication, along with link to publication in Europe PubMed Central."></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                        </tr>
                        </thead>
                        <tbody id="association-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Studies table -->
        <div class="row" style="margin-top:20px">
            <div id="study_panel" class="panel panel-default">
                <div class="panel-heading background-color-primary-accent">
                    <h3 class="panel-title">
                        <span class="study_label">Studies</span><span class="study_count badge"
                                                                      style="background-color: #398A96;margin-left:10px"></span>
                    </h3>

                    <span class="pull-right clickable panel-collapsed"
                          onclick="toggleSidebar('#study_panel span.clickable')">
                        <span class="glyphicon glyphicon-chevron-down"></span>
                    </span>
                </div>

                <div class="panel-body" style="display:none">
                    <table id="study-table" class="table table-striped">
                        <thead id="study-table-header">
                        <tr>
                            <th style="width: 12%" id="author_s">Author
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="First author, along with link to publication in Europe PubMed Central."></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 10%" id="publicationDate">Date
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Publication date (YYYY-MM-DD)"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 12%" id="publication">Journal
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Abbreviated journal name"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 30%" id="title">Title
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Title of paper"></span>
                                                              <!--<span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>-->
                            </th>
                            <th style="width: 12%" id="sample_i">Initial sample description
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Description of the initial sample analysed in the study"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 12%" id="sample_r">Replication sample description
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="Description of the replication sample analysed in the study"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                            <th style="width: 12%" id="ancestral_gp">Ancestral groups
                                <span class="glyphicon glyphicon-question-sign context-help"
                                      data-toggle="tooltip"
                                      data-original-title="List of the ancestral groups analysed in the study"></span>
                                <span class="glyphicon glyphicon-sort clickable sorting unsorted"> </span>
                            </th>
                        </tr>
                        </thead>
                        <tbody id="study-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!--debug information-->
        <div class="row" style="margin-top:10px">
            <div class="panel panel-default">
                <div class="panel-heading background-color-primary-accent">
                    <h3 class="panel-title">debug information</h3>
                </div>
                <div class="col-lg-12">
                    <button id="addEfoButton0" class="addEfoButton" th:value="${result.query}">reset</button>
                    <button id="addEfoButton1"
                            class="addEfoButton"
                            value="EFO_0004211">EFO_0004211 Hypertriglyceridemia</button>
                    <button id="addEfoButton2"
                            class="addEfoButton"
                            value="EFO_0001060">celiac disease EFO_0001060</button>
                    <button id="addEfoButton3" class="addEfoButton" value="EFO_0000400,EFO_0004211,EFO_0001060">EFO_0000400 OR EFO_0004211 OR EFO_0001060</button>
                </div>

                <div class="col-lg-12">
                    <div id="debug">debug information</div>
                </div>
            </div>
        </div>
    </div>

    <!--Include footer-->
    <div th:include="fragments/footer :: page_footer"></div>

</div>

<!-- Bootstrap core JavaScript
    ================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>-->
<script src="../static/tmp/jquery.min.js" th:src="@{../../tmp/jquery.min.js}"></script>

<!--<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>-->
<script src="../static/tmp/jquery-ui.min.js" th:src="@{../../tmp/jquery-ui.min.js}"></script>

<script src="../static/js/bootstrap.min.js" th:src="@{../../js/bootstrap.min.js}"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="../static/js/ie10-viewport-bug-workaround.js"
        th:src="@{../../js/ie10-viewport-bug-workaround.js}"></script>

<script>
    $(document).ready(function() {
        $('[data-toggle="tooltip"]').tooltip();
    });
</script>

<!-- GOCI JavaScript
================================================== -->
<script src="../static/js/goci-ui.js" th:src="@{../../js/goci-ui.js}"></script>
<script src="../static/js/efotraitresult.js" th:src="@{../../js/efotraitresult.js}"></script>

<!-- Necessary includes for LocusZoom.js -->
<!--<script src="https://d3js.org/d3.v4.min.js"></script>-->
<script src="../static/js/plugins/locuszoom.vendor.min.js"
        th:src="@{../../js/plugins/locuszoom.vendor.min.js}"></script>
<script src="../static/js/plugins/locuszoom.app.js" th:src="@{../../js/plugins/locuszoom.app.js}"></script>
<link rel="stylesheet" href="../static/css/locuszoom.css" th:href="@{../../css/locuszoom.css}"/>

<!--script for OLS-->
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/jstree/3.2.1/jstree.min.js"></script>-->
<script src="../static/tmp/jstree.min.js" th:src="@{../../tmp/jstree.min.js}"></script>

<script src="../static/js/plugins/ols-treeview.js" th:src="@{../../js/plugins/ols-treeview.js}"></script>
<!--<script src="../static/js/plugins/ols-treeview.min.js" th:src="@{../../js/plugins/ols-treeview.min.js}"></script>-->
<link rel="stylesheet"
      href="../static/css/proton/style.min.css"
      th:href="@{../../css/proton/style.min.css}"
      media="screen"/>

<!--ols auto suggest-->
<link rel="stylesheet" href="../static/css/ols_auto_complete/ols.css" th:href="@{../../css/ols_auto_complete/ols.css}"/>
<link rel="stylesheet"
      href="../static/css/ols_auto_complete/ols-colors.css"
      th:href="@{../../css/ols_auto_complete/ols-colors.css}"/>
<link rel="stylesheet"
      href="../static/css/ols_auto_complete/typeaheadjs.css"
      th:href="@{../../css/ols_auto_complete/typeaheadjs.css}"/>
<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.min.js"></script>-->
<script src="../static/tmp/handlebars.min.js" th:src="@{../../tmp/handlebars.min.js}"></script>

<!--<script src="https://cdnjs.cloudflare.com/ajax/libs/corejs-typeahead/0.11.1/typeahead.bundle.min.js"></script>-->
<script src="../static/tmp/typeahead.bundle.min.js" th:src="@{../../tmp/typeahead.bundle.min.js}"></script>

<script src="../static/js/plugins/ols-autocomplete.js" th:src="@{../../js/plugins/ols-autocomplete.js}"></script>


<div id="loadingResults" class="col-md-offset-4" style="display: none">
    <button class="btn btn-lg">
        <span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"
              style="margin-right: 1em;"></span>Loading...
    </button>
</div>
<script>
    $('#loadingResults').show();
</script>

<!--<script src="../static/js/efotrait-locuszoom.js" th:src="@{../../js/efotrait-locuszoom.js}"></script>-->





<script>
    /*
     This is the EFOWAS locus zoom plot
     */

    // Genome base pairs static data
    var genome_data = [
        {chr: 1, base_pairs: 249250621},
        {chr: 2, base_pairs: 243199373},
        {chr: 3, base_pairs: 198022430},
        {chr: 4, base_pairs: 191154276},
        {chr: 5, base_pairs: 180915260},
        {chr: 6, base_pairs: 171115067},
        {chr: 7, base_pairs: 159138663},
        {chr: 8, base_pairs: 146364022},
        {chr: 9, base_pairs: 141213431},
        {chr: 10, base_pairs: 135534747},
        {chr: 11, base_pairs: 135006516},
        {chr: 12, base_pairs: 133851895},
        {chr: 13, base_pairs: 115169878},
        {chr: 14, base_pairs: 107349540},
        {chr: 15, base_pairs: 102531392},
        {chr: 16, base_pairs: 90354753},
        {chr: 17, base_pairs: 81195210},
        {chr: 18, base_pairs: 78077248},
        {chr: 19, base_pairs: 59128983},
        {chr: 20, base_pairs: 63025520},
        {chr: 21, base_pairs: 48129895},
        {chr: 22, base_pairs: 51304566},
        {chr: 23, base_pairs: 156040895},
        {chr: 24, base_pairs: 57227415},

    ];

    //use to work out where the variant is on the plot when the whole x axis was used to represent all chromosomes
    //       [{"chr": 1, "base_pairs": 249250621, "genome_start": 0, "genome_end": 249250621, "tickpoint": 124625311},
    //        {"chr": 2, "base_pairs": 243199373, "genome_start": 249250621, "genome_end": 492449994, "tickpoint": 370850308}]
    var genome_data_merged = [];
    var genome_end = 0;
    genome_data.forEach(function(d, i) {
        genome_data_merged.push({});
        genome_data_merged[i].chr = d.chr;
        genome_data_merged[i].base_pairs = d.base_pairs;

        genome_data_merged[i].genome_start = genome_end;

        genome_end += d.base_pairs;
        genome_data_merged[i].genome_end = genome_end

        genome_data_merged[i].tickpoint = genome_data_merged[i].genome_start + Math.round(d.base_pairs / 2);

    });

    LocusZoom.Data.EfoWASSource = LocusZoom.Data.Source.extend(function(init) {
        this.parseInit(init);
    }, "EfoWASLZ");

    //we are not using api to fetch data, when
    LocusZoom.Data.EfoWASSource.prototype.getURL = function(state, chain, fields) {
        return "http://localhost:8280/gwas/tmp/association.json";
    };

    //any post process after getting the JSON
    //we are not using api to fetch data, during init, blank data will be pass to the plot
    //when efo term(s) being selected, these will be replaced with the efo-assoication data
    LocusZoom.Data.EfoWASSource.prototype.parseResponse = function(resp, chain, fields, outnames, trans) {
        var data = JSON.parse([]);
        return {header: chain.header, body: data};
    };

    //adding extra information for plotting for the efo association (association doc in this case)
    LocusZoom.Data.EfoWASSource.prototype.parseResponse = function(resp, chain, fields, outnames, trans) {
        var data = JSON.parse(resp);
        data.forEach(function(d, i) {
            data[i].chr = data[i].chromosomeName[0];
            data[i].bp = data[i].chromosomePosition[0];
            data[i].pval = Math.pow(10, data[i].pValueExponent);
            data[i].phewas_string = data[i].accessionId;
            data[i].x = transferLocation(data[i].chr, data[i].bp);

        });
        return {header: chain.header, body: data};
    };

    //control  x,y,and points
    LocusZoom.Layouts.add("data_layer", "efowas_pvalues", {
        id: "efowaspvalues",
        type: "scatter",
        point_shape: "circle",
        point_size: 30,
        tooltip_positioning: "vertical",
        id_field: "{{namespace}}id",
        fields: ["{{namespace}}phewas"],
        always_hide_legend: false,
        x_axis: {
            field: "{{namespace}}x",
            floor: 0,
            ceiling: 3094301596
        },
        y_axis: {
            axis: 1,
            field: "{{namespace}}pval|neglog10",
            floor: 0,
            upper_buffer: 0.1
        },
        //xintodo Set defaul color for categories
        color: {
            field: "{{namespace}}preferedEFO",
            scale_function: "categorical_bin",
            parameters: {
                categories: ["infectious diseases", "neoplasms", "endocrine/metabolic", "hematopoietic",
                    "mental disorders", "neurological", "sense organs", "circulatory system", "respiratory",
                    "digestive", "genitourinary", "pregnancy complications", "dermatologic", "musculoskeletal",
                    "congenital anomalies", "symptoms", "injuries  poisonings"],
                values: ["rgb(57,59,121)", "rgb(82,84,163)", "rgb(107,110,207)", "rgb(156,158,222)", "rgb(99,121,57)",
                    "rgb(140,162,82)", "rgb(181,207,107)", "rgb(140,109,49)", "rgb(189,158,57)", "rgb(231,186,82)",
                    "rgb(132,60,57)", "rgb(173,73,74)", "rgb(214,97,107)", "rgb(231,150,156)", "rgb(123,65,115)",
                    "rgb(165,81,148)", "rgb(206,109,189)", "rgb(222,158,214)"],
                null_value: "#B8B8B8"
            }
        },
        legend: [],
        fill_opacity: 0.7,
        //xintodo datapoint tooltips
        tooltip: {
            closable: true,
            show: {or: ["highlighted", "selected"]},
            hide: {and: ["unhighlighted", "unselected"]},
            html: "<div><strong>{{{{namespace}}phewas_string}}</strong></div>" +
            "<div>efos: <strong>{{{{namespace}}pval|scinotation}}</strong></div>" +
            "<div>prefered EFO: <strong>{{{{namespace}}preferedEFO}}</strong></div>"
        },
        behaviors: {
            onmouseover: [
                {action: "set", status: "highlighted"}
            ],
            onmouseout: [
                {action: "unset", status: "highlighted"}
            ],
            onclick: [
                {action: "toggle", status: "selected", exclusive: true}
            ],
            onshiftclick: [
                {action: "toggle", status: "selected"}
            ]
        },
//        label: {
//            text: "{{{{namespace}}phewas_string}}",
//            spacing: 8,
//            lines: {
//                style: {
//                    "stroke-width": "2px",
//                    "stroke": "#333333",
//                    "stroke-dasharray": "2px 2px"
//                }
//            },
//            filters: [
//                {
//                    field: "{{namespace}}pval|neglog10",
//                    operator: ">=",
//                    value: 5
//                }
//            ],
//            style: {
//                "font-size": "10px",
//                "font-weight": "bold",
//                "fill": "#333333"
//            }
//        }
    });

    //init x,y ticks, adding data layer
    LocusZoom.Layouts.add("panel", "efowas", {
        id: "efowas",
        width: 800,
        height: 300,
        min_width: 800,
        min_height: 300,
        proportional_width: 1,
        margin: {top: 20, right: 50, bottom: 120, left: 50},
        inner_border: "rgb(210, 210, 210)",
        dashboard: (function() {
            var l = LocusZoom.Layouts.get("dashboard", "standard_panel", {unnamespaced: true});
            l.components.push({
                                  type: "toggle_legend",
                                  position: "right"
                              });
//            l.components.push({
//                                  type: "resize_to_data",
//                                  position: "right"
//                              });
            return l;
        })(),
        axes: {
            x: {
                label: "Genomic Position (number denotes chromosome)",
                label_offset: 35,
                ticks: [
                    {
                        x: 124625310,
                        text: "1",
                        style: {
                            "fill": "rgb(120, 120, 186)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 370850307,
                        text: "2",
                        style: {
                            "fill": "rgb(0, 0, 66)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 591461209,
                        text: "3",
                        style: {
                            "fill": "rgb(120, 120, 186)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 786049562,
                        text: "4",
                        style: {
                            "fill": "rgb(0, 0, 66)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 972084330,
                        text: "5",
                        style: {
                            "fill": "rgb(120, 120, 186)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 1148099493,
                        text: "6",
                        style: {
                            "fill": "rgb(0, 0, 66)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 1313226358,
                        text: "7",
                        style: {
                            "fill": "rgb(120, 120, 186)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 1465977701,
                        text: "8",
                        style: {
                            "fill": "rgb(0, 0, 66)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 1609766427,
                        text: "9",
                        style: {
                            "fill": "rgb(120, 120, 186)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 1748140516,
                        text: "10",
                        style: {
                            "fill": "rgb(0, 0, 66)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 1883411148,
                        text: "11",
                        style: {
                            "fill": "rgb(120, 120, 186)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 2017840353,
                        text: "12",
                        style: {
                            "fill": "rgb(0, 0, 66)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 2142351240,
                        text: "13",
                        style: {
                            "fill": "rgb(120, 120, 186)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 2253610949,
                        text: "14",
                        style: {
                            "fill": "rgb(0, 0, 66)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 2358551415,
                        text: "15",
                        style: {
                            "fill": "rgb(120, 120, 186)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 2454994487,
                        text: "16",
                        style: {
                            "fill": "rgb(0, 0, 66)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 2540769469,
                        text: "17",
                        style: {
                            "fill": "rgb(120, 120, 186)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 2620405698,
                        text: "18",
                        style: {
                            "fill": "rgb(0, 0, 66)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 2689008813,
                        text: "19",
                        style: {
                            "fill": "rgb(120, 120, 186)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 2750086065,
                        text: "20",
                        style: {
                            "fill": "rgb(0, 0, 66)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 2805663772,
                        text: "21",
                        style: {
                            "fill": "rgb(120, 120, 186)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: 2855381003,
                        text: "22",
                        style: {
                            "fill": "rgb(0, 0, 66)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: genome_data_merged[22].tickpoint,
                        text: "X",
                        style: {
                            "fill": "rgb(120, 120, 186)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                    {
                        x: genome_data_merged[23].tickpoint,
                        text: "Y",
                        style: {
                            "fill": "rgb(0, 0, 66)",
                            "text-anchor": "center",
                            "font-size": "13px",
                            "font-weight": "bold"
                        },
                        transform: "translate(10, 5)  rotate(35)"
                    },
                ]
            },
            y1: {
                label: "-log10 p-value",
                label_offset: 28
            }
        },
        legend: {
            orientation: "vertical",
            origin: {x: 55, y: 40},
            hidden: true
        },
        data_layers: [
            LocusZoom.Layouts.get("data_layer", "significance", {unnamespaced: true}),
            LocusZoom.Layouts.get("data_layer", "efowas_pvalues", {unnamespaced: true})
        ]
    });

    //the plot, adding efowas panel
    LocusZoom.Layouts.add("plot", "standard_efowas", {
        width: 800,
        height: 600,
        min_width: 800,
        min_height: 600,
        responsive_resize: true,
        dashboard: LocusZoom.Layouts.get("dashboard", "standard_plot", {unnamespaced: true}),
        panels: [
            LocusZoom.Layouts.get("panel", "efowas", {unnamespaced: true, proportional_height: 0.45})
        ],
        mouse_guide: false
    });

    //given a location, map it to the plot xais
    transferLocation = function(chr, position) {
        return genome_data_merged[chr - 1].genome_start + position;
    }

    //replot receive a list of association_docs from solr search
    readlodLocusZoom = function(plot_id, data_association) {
        //adding information to association doc
        LocusZoom.Data.EfoWASSource.prototype.parseResponse = function(resp, chain, fields, outnames, trans) {
            var data = JSON.parse(JSON.stringify(data_association.docs));
            console.log("Parsing association doc to locus zoom.");
            console.log(data_association.docs);
            data.forEach(function(d, i, object) {
//                if (d.shortForm.length > 1) {
//                    console.log(d);
//                }

                if (d.chromLocation) {
                    //we only plot those association which have chromosome information
                    data[i].chr = d.chromLocation[0].split(":")[0];
                    if (data[i].chr == 'X') {
                        data[i].chr = 23;
                    }
                    if (data[i].chr == 'Y') {
                        data[i].chr = 24;
                    }
                    data[i].bp = parseInt(d.chromLocation[0].split(":")[1]);
                    data[i].pval = Math.pow(10, d.pValueExponent);
                    data[i].phewas_string = d.rsId[0];
                    data[i].x = transferLocation(data[i].chr, data[i].bp);
                }
                else {
                    //some association don't have chromosome information
                    object.splice(i, 1);
                }

            });
            return {header: chain.header, body: data};
        };

        var data_sources = new LocusZoom.DataSources()
                .add("base", ["EfoWASLZ", {url: "www.api.com"}]);


        var layout = LocusZoom.Layouts.get("plot", "standard_efowas");
        layout.panels[0].margin.top = 32;
        layout.panels[0].data_layers[0].offset = 7.30103; // Higher offset for line of GWAS significance than the default 4.522

        //xintodo create the color palate here
        //find all efos for plotting color
        var legend = [];
        var colorMap = {};

//
//        data_association.docs.forEach(function(d, i) {
//            //algorithm for select efo for association
////            allEFO.push(d.mappedUri[0]);
//            allEFO.push( d.preferedEFO);
//        })
//        //unique only
//        allEFO = allEFO.filter(function(value, index, self) {
//            return self.indexOf(value) === index;
//        })
//        //random rgb color at, legend does not work atm
//        allEFO.forEach(function(d, i) {
//            col = 'rgb(' + (Math.floor(Math.random() * 256)) + ',' + (Math.floor(Math.random() * 256)) +
//                    ',' + (Math.floor(Math.random() * 256)) + ')';
//            allColor.push(col);
//            legend.push({
//                            shape: "rect",
//                            color: col,
//                            width: 9,
//                            label: d
//                        }
//            )
//        })

        function hexToRgb(hex) {
            var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
//            return result ? {
//                        r: parseInt(result[1], 16),
//                        g: parseInt(result[2], 16),
//                        b: parseInt(result[3], 16)
//                    } : null;
            return result ? 'rgb(' + parseInt(result[1], 16) + ','
                    + parseInt(result[2], 16) + ','
                    + parseInt(result[3], 16) + ')' : 'rgb(255,255,255)';
        }

        data_association.docs.forEach(function(d, i) {
            //algorithm for select efo for association
            colorMap[d.preferedEFO] = hexToRgb(d.preferedColor);

        })
        legend_catgories = [];
        legend_color = [];
        for (var key in colorMap) {
            legend_catgories.push(key);
            legend_color.push(colorMap[key]);
            legend.push({
                            shape: "rect",
                            color: colorMap[key],
                            width: 9,
                            label: key
                        }
            )
        }
        layout.panels[0].data_layers[1].color.parameters.categories = legend_catgories;
        layout.panels[0].data_layers[1].color.parameters.values = legend_color;
        layout.panels[0].data_layers[1].legend = legend;


        // Generate the plot
        var plot = LocusZoom.populate(plot_id, data_sources, layout);
    }
</script>

<script>

    //xintodo add/remove terms when select/disselect terms
    addEFO = function(data, initLoad, key) {

        if (initLoad === undefined) {
            initLoad = false;
        }
        key = key || 'efoids';
        current = $("#selected_efos").data(key) || {};
        newselect = $.extend({}, current, data);
        $("#selected_efos").data(key, newselect).trigger('addToSelect', [newselect, initLoad]);
    }

    $('#selected_efos').on('addToSelect', function(e, newselect, initLoad) {
        //print out terms:
        text = '';
        $.each(newselect, function(index, value) {
            text = text + index + ':' + value + '<br/>';
        });
        $("#selected_efos_text").html(text);
        getEfoTraitData(Object.keys(newselect).join(','), initLoad);
    });

    removeEFO = function(data, key) {

    }

</script>


<!--local data-->
<script>
    $('.addEfoButton').click(function() {
        elements = {};
        $(this).attr('value').split(',').forEach(function(index, value) {
            elements[index] = index;
        });
        //xintodo first load
        addEFO(elements, true);
//        getEfoTraitData($(this).attr('value'));
//        console.log('clicked' + $(this).attr('value'));
    });


    $(document).ready(function() {
        if (window.location.pathname.indexOf("beta") != -1) {
            $('#beta-icon').show();
        }
        var searchTerm = $('#query').text();
        console.log("Loading search module!");
        console.log("efoTrait: " + searchTerm);
        if (searchTerm != '') {
            console.log("Start search for the efotrait " + searchTerm);

            elements = {};
            elements[searchTerm] = searchTerm;
            //xintodo first load
            addEFO(elements, true);
//            getEfoTraitData(searchTerm, true);
        }
    });

    function getEfoTraitData(efotraitId, initLoad) {
        // initLoad will be pass to processEfotraitData, controlling whether to upload the triat information(init load)
        // or just reload the tables(adding another efo term)
        if (initLoad === undefined) {
            initLoad = false;
        }


        console.log("Solr research request received for " + efotraitId);
        setState(SearchState.LOADING);
        $.getJSON('/gwas/api/search/efotrait',
                  {
                      'q': efotraitId,
                      'max': 9999,
                      'group.limit': 9999,
                      'group.field': 'resourcename',
                      'facet.field': 'resourcename',
                      'hl.fl': 'shortForm,efoLink',
                      'hl.snippets': 100
                  })
                .done(function(data) {
//                    console.log(data);
                    //xintodo consider if you want to do it this way, or just change the seach and update the tables
                    //saveData(data.responseHeader.params.q, data);
                    //we only process data here if it is the init load of the page, since we need to add new data to the page dynamically
                    processEfotraitData(data, efotraitId, initLoad);
                });
        //serilize the data in html tag and save it in a tag for visulization
        console.log("Solr research done for " + efotraitId);

    }
    //     Parse the Solr results and display the data on the HTML page
    function processEfotraitData(data, efotraitId, initLoad) {
        // Check if Solr returns some results
        if (data.grouped.resourcename.matches == 0) {
            $('#lower_container').html("<h2>The efotrait <em>" + efotraitId +
                                       "</em> cannot be found in the GWAS Catalog database</h2>");
        }
        else {
            //split the solr search by groups
            var data_efo, data_study, data_association, data_diseasetrait;
            var data_facet = data.facet_counts.facet_fields.resourcename;
            var data_highlighting = data.highlighting;

            $.each(data.grouped.resourcename.groups, function(index, group) {
                switch (group.groupValue) {
                    case "efotrait":
                        data_efo = group.doclist;
                        break;
                    case "study":
                        data_study = group.doclist;
                        break;
                    case "association":
                        data_association = group.doclist;
                        break;
                        //not sure we need this!
                    case "diseasetrait":
                        data_diseasetrait = group.doclist;
                        break;
                    default:
                }
            });

            findHightlightedEFOsforAssociation = function(association_id) {
                var terms = data.highlighting[association_id].shortForm;
                return terms;
            }

            findMostSignificantTraitForAssociation = function(traits, association) {
                return traits[0];
            }

            //function to pick a color for a give efo term
            findColorForEFO = function(efo) {
                //xintodo query api for color, may use batch query for efo color
                var url = 'http://wwwdev.ebi.ac.uk/gwas/beta/rest/api/parentMapping/' + efo;
                var data = {
                    uri: "http://www.ebi.ac.uk/efo/EFO_0000400",
                    trait: "diabetes mellitus",
                    parentUri: "http://www.ebi.ac.uk/efo/EFO_0000589",
                    parent: "metabolic disease",
                    colour: "#FDB462"
                }
                return data.colour;
            }


            //xintodo add prefered efo term
            data_association.docs.forEach(function(d, i) {
                traits = findHightlightedEFOsforAssociation(d.id);
                if (traits.length > 1) {
                    d.preferedEFO = findMostSignificantTraitForAssociation(traits, d.id);
                }
                else {
                    d.preferedEFO = traits[0];

                }
                d.preferedColor = findColorForEFO(d.preferedEFO)
            })


            if (initLoad) {
                getEfoTraitInfo(data_efo.docs, efotraitId);
                getSummary(data_study);

            }
            getEfotraitAssociations(data_association.docs);
            getEfotraitStudies(data_study.docs);
            //xintodo reload locus plot here
            readlodLocusZoom('#plot', data_association);

        }
    }

    function newItemWithIdAndData(id, content) {
        var newli = $("<li></li>").attr('id', id).text(content);
        return newli;
    }

    function saveData(id, data) {
        var jsonid = '#json-' + id;
        var $jsondatali = $(jsonid);

        //if the data exists, update
        if ($jsondatali.length) {
            $jsondatali.text = JSON.stringify(data, null, 0);
        }
        else {
            $("#searchdata").append(newItemWithIdAndData('json-' + id, JSON.stringify(data, null, 0)));
        }

    }

    function loadData(id) {
        var jsontext = $('#json-' + id).text();
        return jsontext;
    }

</script>


<!--ols-->
<script>

    var app = require("ols-treeview");
    var instance = new app();

    options = {
        checkbox: true,
        checkbox_cascade: '',
        checkbox_three_state: false,
        checkbox_keep_selected_style: false,
        onchange: function(e, data) {
//            console.log("newly selected:")
//            console.log(data.changed.selected);
//            console.log("newly deselected:")
//            console.log(data.changed.deselected);
//            console.log("event passed to onChange:")
//            console.log(e); // newly selected
//            console.log("data passed to onChange:")
//            console.log(data); // newly deselected
//            console.log(data.instance.get_selected(true));
            elements = {};
            if (data.instance.get_selected(true).length > 0) {
                $.each(data.instance.get_selected(true), function(index, term) {
                    if (term.original.iri) {
                        elements['EFO_' + term.original.iri.split('EFO_')[1]] = term.original.text;
                    }
                });
                //xintodo tree load
                addEFO(elements);
//                console.log(data.instance.get_node(data.selected));
            }
        },
    }


    var searchTerm = $('#query').text();
    // initialise the tree
    //xintodo tempral disable for offline debug
    instance.draw($("#term-tree"),
                  true,
                  "efo",
                  "terms",
                  "http://www.ebi.ac.uk/efo/" + searchTerm,
                  "http://www.ebi.ac.uk/ols/",
                  options);


</script>

<!--ols search-->
<script>
    //ols search
    //xintodo tempral disable for offline debug
    $.getJSON('http://www.ebi.ac.uk/ols/api/search',
              {
                  'q': $('#query').text(),
                  'ontology': 'efo',
                  'fieldList': 'iri,ontology_name,ontology_prefix,short_form,description,id,label,is_defining_ontology,obo_id,type,logical_description'
              })
            .done(function(data) {
                console.log(data);
                data.response.docs.forEach(function(d, i) {
                    d.obo_id = d.obo_id.replace(":", "_")
                    addCheckbox('cb' + d.obo_id, d.obo_id + ' : ' + d.label, 'efocheckbox');
                    $("#" + 'whycb' + d.obo_id).html(d.logical_description);
//                    $("#"+'whycb'+d.obo_id).html(longContentList("#"+'whycbhiddent'+d.obo_id, ['a','b'], 'why'))
                    if (d.obo_id == $('#query').text()) {
                        $("#cb" + d.obo_id).attr("checked", true);
                    }
                })


                $(".efocheckbox").change(function() {
//                    console.log($('input:checked'));
                    elements = {};
                    $('input:checked').each(function() {
                        elements[$(this).attr('value').split(" : ")[0]] = $(this).attr('value').split(" : ")[1];
                    });
//                    xintodo checkbox load
                    addEFO(elements);
                });
            });


    function addCheckbox(id, name, cbclass) {
        var container = $('#expension');
        $('<input />', {type: 'checkbox', id: id, class: cbclass, value: name}).appendTo(container);
        $('<label />', {'for': id, text: name}).appendTo(container);
        $('<div />', {'id': 'why' + id}).appendTo(container);

        $('<br />').appendTo(container);

    }
</script>

<!--ols auto complete-->
<script>
    //xintodo tempral disable for offline debug
    $(document).ready(function() {
        var app = require("ols-autocomplete");
        var instance = new app();
        options = {
            action: function(relativePath, suggestion_ontology, type, iri) {
//                console.log("In overwritten function")
//                console.log("Relative Path: " + relativePath)
//                console.log("Suggested Ontology: " + suggestion_ontology)
//                console.log("Type (optional): " + type)
//                console.log("iri (optional): " + iri)
                elements = {};
                elements['EFO_' + iri.split("EFO_")[1]] = 'EFO_' + iri.split("EFO_")[1];
                //xintodo auto load
                addEFO(elements);
            }
        }
        instance.start(options)
    });


</script>


</body>
</html>
<!--//EFO:0000400-->
<!--//    http://localhost:8280/gwas/beta/efotrait/EFO_0000400-->
<!--https://wwwdev.ebi.ac.uk/gwas/beta/rest/docs/index-->
<!--https://wwwdev.ebi.ac.uk/gwas/beta/rest/api/efoTraits/search-->
<!--https://wwwdev.ebi.ac.uk/gwas/beta/rest/api/efoTraits-->
<!--https://wwwdev.ebi.ac.uk/gwas/beta/rest/api-->
<!--https://wwwdev.ebi.ac.uk/gwas/beta/rest/api/efoTraits/71-->
<!--https://wwwdev.ebi.ac.uk/gwas/beta/rest/api/efoTraits/search/findByUri?uri=http://www.ebi.ac.uk/efo/EFO_0000400-->
<!--https://michigangenomics.org/genetic_data.html-->
<!--https://github.com/statgen/locuszoom/wiki/Data-Sources-->
<!--http://wwwdev.ebi.ac.uk/gwas/beta/rest/api/parentMapping/EFO_0000400-->