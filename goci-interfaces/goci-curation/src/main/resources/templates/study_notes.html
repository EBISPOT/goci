<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>GWAS Curation Tool</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>

    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/css/bootstrap-theme.min.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.1/js/bootstrap.min.js"></script>

    <!--Select2: http://ivaynberg.github.io/select2/-->
    <!-- Include Select2 CSS -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/select2/3.5.0/select2.min.css"/>

    <!-- CSS to make Select2 fit in with Bootstrap 3.x -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/select2/3.5.0/select2-bootstrap.min.css"/>

    <!-- Custom styles for this template -->
    <link th:href="@{/css/jumbotron.css}" rel="stylesheet"/>
    <link th:href="@{/css/sticky-footer-navbar.css}" rel="stylesheet"/>

    <link rel="stylesheet" th:href="@{/css/goci-curation.css}"/>
    <link rel="stylesheet" th:href="@{/css/icons/flaticon.css}"/>
    <link rel="stylesheet" th:href="@{/css/goci-color-palette-1.css}"/>

    <!-- Include Select2 JS -->
    <script src="//cdnjs.cloudflare.com/ajax/libs/select2/3.5.0/select2.min.js"></script>

    <!--Tags input http://timschlechter.github.io/bootstrap-tagsinput/examples/-->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/bootstrap.tagsinput/0.4.2/bootstrap-tagsinput.css"/>
    <script src="//cdn.jsdelivr.net/bootstrap.tagsinput/0.4.2/bootstrap-tagsinput.min.js"></script>

    <!--Handles checkbox in table -->
    <script th:src="@{/js/goci-study-association.js}"></script>

    <!--https://www.datatables.net/-->
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/1.10.11/css/dataTables.bootstrap.min.css"/>
    <script type="text/javascript" charset="utf8" src="//cdn.datatables.net/1.10.11/js/jquery.dataTables.js"></script>
    <script type="text/javascript"
            charset="utf8"
            src="//cdn.datatables.net/1.10.11/js/dataTables.bootstrap.min.js"></script>
    <script type="text/javascript"
            charset="utf8"
            src="//cdn.datatables.net/1.10.11/js/jquery.dataTables.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"/>
    <link rel="stylesheet" type="text/css" href="//cdn.datatables.net/buttons/1.1.2/css/buttons.dataTables.min.css"/>

    <script type="text/javascript"
            charset="utf8"
            src="//cdn.datatables.net/buttons/1.1.2/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript"
            charset="utf8"
            src="//cdn.datatables.net/buttons/1.1.2/js/buttons.colVis.min.js"></script>

    <script th:src="@{/js/goci-editing.js}"></script>

</head>
<body>

<!--Include header-->
<div th:include="fragments/header :: navbar"></div>

<div>
    <ol class="breadcrumb pull-right">
        <li><a th:href="@{/studies}">Studies</a></li>
        <li><span th:text="${study.author + '_' + study.id} ?: '' "></span></li>
        <li class="active">Study notes</li>
    </ol>
</div>

<!--Include study navigation tabs-->
<div th:include="fragments/study_navigation_tabs :: tabs"></div>


<!--Top level buttons and modals-->
<div th:include="fragments/association_table_top_level_buttons_published_study :: top_level_published"
     th:if="*{#bools.isTrue(study.housekeeping.isPublished)}"></div>

<div th:include="fragments/association_table_top_level_buttons_and_modals :: top_level"
     th:if="*{#bools.isFalse(study.housekeeping.isPublished)}"></div>

<!--<div th:switch="${study.housekeeping.isPublished}">-->
<!--<div th:case="false">-->
<!--<div th:include="fragments/association_table_top_level_buttons_and_modals :: top_level"></div>-->
<!--</div>-->
<!--<div th:case="true">-->
<!--<div th:include="fragments/association_table_top_level_buttons_published_study :: top_level_published"></div>-->
<!--</div>-->
<!--</div>-->
<br/>

<!--<div class="form-group"  style="display: none">-->
    <label for="publish_flag" class="control-label col-md-2"></label>
    <div class="col-md-10">
        <input type="hidden" th:field="${study.housekeeping.isPublished}" class="form-control" id="publish_flag"/>

    </div>

<div class="col-md-10" style="margin-top:10px">
    <div th:include="fragments/studynote_error :: studynote_update_error"></div>
</div>

<div class="form-group">

<form class="form-horizontal" method="post" name="study-note-form" th:object="${multiStudyNoteForm}">
    <div class="alert alert-danger" th:if="${#fields.hasErrors('*')}">
        <p th:each="err : ${#fields.errors('*')}" th:text="${err}"></p>
    </div>
    <table class="table table-hover table-bordered">
        <thead>
            <tr>
                <!--<th style="font-size: small">Index</th>-->
                <th style="font-size: small">Note(s)</th>
                <th style="font-size: small">NoteSubject</th>
                <th style="font-size: small">Status</th>
                <th style="font-size: small">Curator</th>
                <th style="font-size: small">Published</th>
                <th>
                    <button type="submit" class="btn btn-default btn-sm" name="addNote">Add note</button>
                </th>
            </tr>
        </thead>

        <tbody>
            <tr th:each="note,rowStat: *{noteForms}">
                        <!--Note(s)-->
                        <td>
                           <input type="text" th:field="*{noteForms[__${rowStat.index}__].textNote}"
                                  th:readonly="${study.housekeeping.isPublished} or
                                 not *{noteForms[__${rowStat.index}__].editing}"/>
                            <!--<div th:if="${#fields.errors.field == *{noteForms[__${rowStat.index}__].id}" th:remove="tag">-->
                                <!--<p th:each="err : ${#fields.errors()}" th:text="${err}"></p>-->
                            <!--</div>-->

                            <!--<div class="col-md-10">-->
                                <!--<input type="text" class="form-control" id="pvalueExponent"-->
                                       <!--th:field="*{pvalueExponent}" placeholder="Exponent must &lt; -5" name="pvalueExponent"/>-->
                                <!--<span class="help-inline help-block" th:if="${#fields.hasErrors('pvalueExponent')}" th:errors="*{pvalueExponent}">Exponent Error</span>-->
                            <!--</div>-->

                         </td>
                        <!--NoteSubject-->
                        <td>
                            <select th:field="*{noteForms[__${rowStat.index}__].noteSubject.id}"
                                    th:readonly="${study.housekeeping.isPublished} or
                           not *{noteForms[__${rowStat.index}__].editing}">
                                <option th:each="noteSubject : ${availableNoteSubject}" th:value="${noteSubject.id}"
                                        th:text="${noteSubject.subject}">
                                        th:selected="${noteSubject.id}==*{noteForms[__${rowStat.index}__].noteSubject.id}">
                                </option>
                            </select>
                        </td>
                        <!--Status-->
                         <td>
                             <input  type="hidden" th:field="*{noteForms[__${rowStat.index}__].status}"
                                     th:readonly="${study.housekeeping.isPublished} or
                                      not *{noteForms[__${rowStat.index}__].editing}"/>
                             <div th:switch="*{noteForms[__${rowStat.index}__].status}">
                                    <span th:case="true" class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                                    <span th:case="false" class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                                 <!--<input type="radio" th:field="*{noteForms[__${rowStat.index}__].status} value="true">yes<br>-->
                                 <!--<input type="radio" th:field="*{noteForms[__${rowStat.index}__].status} value="false">no<br>-->
                                </div>
                         </td>
                        <!--Curator-->
                         <td>
                             <input  type="text" th:readonly="readonly"
                                    th:field="*{noteForms[__${rowStat.index}__].curator.lastName}"/>
                         </td>
                        <!--Published-->
                         <td>
                             <div th:switch="${study.housekeeping.isPublished}">
                                 <span th:case="ture" class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                                 <span th:case="false" class="glyphicon glyphicon-remove" aria-hidden="true"></span>
                             </div>
                         </td>

                            <td>
                                <!--<button  th:disabled="${study.housekeeping.isPublished}"-->
                                <button  th:disabled="*{not noteForms[__${rowStat.index}__].canEdit}"
                                         type="submit" name="editNote" th:value="${rowStat.index}"
                                                 class="btn btn-danger btn-sm">
                                    <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>
                                </button>

                                <!--<button th:disabled="${study.housekeeping.isPublished}"-->
                                <button  th:disabled="*{not noteForms[__${rowStat.index}__].canDiscard}"
                                        type="submit" name="discardsEditNote" th:value="${rowStat.index}"
                                        class="btn btn-danger btn-sm">
                                    <span class="glyphicon glyphicon-thumbs-down" aria-hidden="true"></span>
                                </button>

                                <!--<button  th:disabled="${study.housekeeping.isPublished}"-->
                                <button  th:disabled="*{not noteForms[__${rowStat.index}__].canRemove}"
                                        type="submit" name="removeNote" th:value="${rowStat.index}"
                                        class="btn btn-danger btn-sm">
                                    <span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
                                </button>

                                <!--<button th:disabled="${study.housekeeping.isPublished}"-->
                                <button  th:disabled="*{not noteForms[__${rowStat.index}__].canSave}"
                                        type="submit" name="saveNote" th:value="${rowStat.index}"
                                        class="btn btn-danger btn-sm">
                                    <span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span>
                                </button>

                                <input  type="hidden" th:field="*{noteForms[__${rowStat.index}__].id}"/>
                                <input  type="hidden" th:field="*{noteForms[__${rowStat.index}__].genericId}"/>
                                <input  type="hidden" th:field="*{noteForms[__${rowStat.index}__].noteSubject.id}"/>
                                <input  type="hidden" th:field="*{noteForms[__${rowStat.index}__].curator.id}"/>
                            </td>


            </tr>
            </tbody>
    </table>
    <!--<div class="form-group">-->
        <!--<div class="col-md-offset-2 col-md-10">-->
            <!--<button type="submit" class="btn btn-primary">Save</button>-->
        <!--</div>-->
    <!--</div>-->


</form>
</div>

<!--Bottom level buttons and modals-->
<!--<div th:if="(${study.housekeeping.isPublished} == false)">-->
<!--<div th:include="fragments/association_table_bottom_level_buttons_and_modals :: bottom_level"></div>-->
<!--</div>-->
<!--<div th:include="fragments/association_table_bottom_level_buttons_and_modals :: bottom_level"-->
     <!--th:if="*{#bools.isFalse(study.housekeeping.isPublished)}"></div>-->

<div th:include="fragments/footer :: page_footer"></div>


<script>
    $(document).ready(function() {
        var table = $('#mainTable').DataTable({
                                                  info: false,
                                                  paging: false,
                                                  dom: 'Bfrtip',
                                                  buttons: [
                                                      {
                                                          extend: 'colvis',
                                                          columns: ':gt(0)',
                                                          postfixButtons: ['colvisRestore']
                                                      }
                                                  ]
                                              });
    });
</script>

</body>
</html>